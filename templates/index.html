{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="icon" href="{% static 'img/logo.png' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>EAM</title>
</head>

<body onload="first_song_player()">
<header>
    <div class="menu_side" >
        <div style="margin-left: 30px;margin-top: 10px; margin-bottom: -10px;">
        <img src="{% static 'img/logo.png' %}" width="60" height="60">
        </div>
        <div class="playlist">
            <h4 class="active"><span></span><i class="bi bi-music-note-beamed"></i> Playlist</h4>
            <h4 ><span></span><i class="bi bi-music-note-beamed"></i> Artists</h4>
            <h4 ><span></span><i class="bi bi-music-note-beamed"></i> Songs</h4>
        </div>
        <div class="menu_song">
            <li class="songItem">
                <span>01</span>
                <img src="{% static  'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="1"></i>
            </li>
            <li class="songItem">
                <span>02</span>
                <img src="{% static 'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="2"></i>
            </li>
            <li class="songItem">
                <span>03</span>
                <img src="{% static 'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="3"></i>
            </li>
            <li class="songItem">
                <span>04</span>
                <img src="{% static 'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="4"></i>
            </li>
            <li class="songItem">
                <span>05</span>
                <img src="{% static 'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="5"></i>
            </li>
            <li class="songItem">
                <span>06</span>
                <img src="{% static 'img/1.jpg' %}" alt="Alan">
                <h5>
                    On My Way
                    <div class="subtitle">Alan Walker</div>
                </h5>
                    <i class="bi playListPlay bi-play-circle-fill" id="6"></i>
            </li>
        </div>
    </div>


    <div class="song_side">
        <nav>
            <ul>
                <li>Discover <span></span></li>
                <li>Recents</li>
                <li>Favourites</li>
                <li>Enjoy Offline</li>
                <li>Profile</li>
            </ul>
            <div class="search">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search Music...">
            </div>
        </nav>
        <div class="content">
            <h1>Emotion Aware Music</h1>
            <p>
                Lets have a great music player, Feel the music based on emotion.
                <br>
                Emotion, Emotion, Emotion We don't like we avoid, but Emotion likes us, We can't avoid.
            </p>
            <div class="buttons">
                    <form action="{% url 'home' %}" method="POST" id="act">{% csrf_token %}
                        <button type="submit" id="clickHere">let your emotion decide your music</button>
                    </form>
                        
                </a>
            </div>
        </div>
        <div class="popular_song">
            <div class="h4">
                <h4>Popular Song</h4>
                <div class="btn_s">
                    <i id="left_scroll" class="bi bi-arrow-left-short"></i>
                    <i id="right_scroll" class="bi bi-arrow-right-short"></i>
                </div>
            </div>
            <div class="pop_song">
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="7"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="8"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="9"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="10"></i>
                        <!-- change All id  -->
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="11"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="12"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="13"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="14"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                <li class="songItem">
                    <div class="img_play">
                        <img src="{% static 'img/1.jpg' %}" alt="alan">
                        <i class="bi playListPlay bi-play-circle-fill" id="15"></i>
                    </div>
                    <h5>On My Way
                        <br>
                        <div class="subtitle">Alan Walker</div>
                    </h5>
                </li>
                
            </div>
        </div>
        <div class="popular_artists">
            <div class="h4">
                <h4>About</h4>
            </div>
            <div class="item">
                <li>
                    <img src="{% static 'img/kartheek.jpg' %}" alt="Kartheek" title="Kartheek">
                </li>
                <li>
                    <img src="{% static 'img/naveen.jpg' %}" alt="Naveen" title="Naveen">
                </li>
                <li>
                    <img src="{% static 'img/yamuna.png' %}" alt="Yamuna" title="Yamuna">
                </li>
                <li>
                    <img src="{% static 'img/balasri.png' %}" alt="Balasri" title="Balasri">
                </li>
                <li>
                    <img src="{% static 'img/rama.png' %}" alt="Rama" title="Rama">
                </li>

                
            </div>
        </div>
    </div>


    <div class="master_play">
        <div class="wave">
            <div class="wave1"></div>
            <div class="wave1"></div>
            <div class="wave1"></div>
        </div>
        <img src="{% static 'img/26th.jpg' %}" alt="Alan" id="poster_master_play">
        <h5 id="title">Vande Mataram<br>
            <div class="subtitle">Bankim Chandra</div>
        </h5>
        <div class="icon">
            <i class="bi bi-skip-start-fill" id="back"></i>
            <i class="bi bi-play-fill" id="masterPlay"></i>
            <i class="bi bi-skip-end-fill" id="next"></i>
        </div>
        <span id="currentStart">0:00</span>
        <div class="bar">
            <input type="range" id="seek" min="0" value="0" max="100">
            <div class="bar2" id="bar2"></div>
            <div class="dot"></div>
        </div>
        <span id="currentEnd">0:00</span>

        <div class="vol">
            <i class="bi bi-volume-down-fill" id="vol_icon"></i>
            <input type="range" id="vol" min="0" value="30" max="100">
            <div class="vol_bar"></div>
            <div class="dot" id="vol_dot"></div>
        </div>
    </div>
</header>
    <script>
        const music = new Audio("{% static 'audio/vande.mp3' %}");
        // alert("{{ res }}");

            // create Array 
            var xd="{{ resexp }}";
            
            var anger=["anger1",2,3,4,5,6]
            var sad=["sad1",2,3,4,5,6]
            var happy=[1,2,3,"happy4",5,6]
            var disgust=[1,"disgust2",3,4,5,6]
            var surprise=[1,2,3,4,"surprise5",6]
            var fear=["fear1",2,3,4,5,6]
            const songs = [
                // {
                //     id:'1',
                //     songName:` On My Way <br>
                //     <div class="subtitle">Alan Walker</div>`,
                //     poster: "{% static 'img/1.jpg' %}"
                // },
                // {
                //     id:'2',
                //     songName:` Alan Walker-Fade <br>
                //     <div class="subtitle">Alan Walker</div>`,
                //     poster: "{% static 'img/2.jpg' %}"
                // },
                // // all object type 
                // {
                //     id:"3",
                //     songName: `Cartoon - On & On <br><div class="subtitle"> Daniel Levi</div>`,
                //     poster: "{% static 'img/3.jpg' %}",
                // },
                // {
                //     id:"4",
                //     songName: `Warriyo - Mortals <br><div class="subtitle">Mortals</div>`,
                //     poster: "{% static 'img/4.jpg' %}",
                // },
                // {
                //     id:"5",
                //     songName: `Ertugrul Gazi <br><div class="subtitle">Ertugrul</div>`,
                //     poster: "{% static 'img/5.jpg' %}",
                // },
                // {
                //     id:"6",
                //     songName: `Electronic Music <br><div class="subtitle">Electro</div>`,
                //     poster: "{% static 'img/6.jpg' %}",
                // },
                {
                    id:'1',
                    songName:` {{ resexp }}0 <br>
                    <div class="subtitle">Alan Walker</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:'2',
                    songName:` {{ resexp }}2 <br>
                    <div class="subtitle">Alan Walker</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:"3",
                    songName: `{{ resexp }}3 <br><div class="subtitle"> {{ resexp }}3</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:"4",
                    songName: `{{ resexp }}4<br><div class="subtitle">{{ resexp }}4</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:"5",
                    songName: `{{ resexp }}5 <br><div class="subtitle">{{ resexp }}5</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:"6",
                    songName: `{{ resexp }}6 <br><div class="subtitle">{{ resexp }}6</div>`,
                    poster: "/static/img/"+"{{ resexp }}"+".jpg",
                },
                {
                    id:"7",
                    songName: `Agar Tum Sath Ho <br><div class="subtitle">Tamashaa</div>`,
                    poster: "{% static 'img/7.jpg' %}",
                },
                {
                    id:"8",
                    songName: `Suna Hai <br><div class="subtitle">Neha Kakker</div>`,
                    poster: "{% static 'img/8.jpg' %}",
                },
                {
                    id:"9",
                    songName: `Dilber <br><div class="subtitle">Satyameva Jayate</div>`,
                    poster: "{% static 'img/9.jpg' %}",
                },
                {
                    id:"10",
                    songName: `Duniya <br><div class="subtitle">Luka Chuppi</div>`,
                    poster: "{% static 'img/10.jpg' %}",
                },
                {
                    id:"11",
                    songName: `Lagdi Lahore Di <br><div class="subtitle">Street Dancer 3D</div>`,
                    poster: "{% static 'img/11.jpg' %}",
                },
                {
                    id:"12",
                    songName: `Putt Jatt Da <br><div class="subtitle">Putt Jatt Da</div>`,
                    poster: "{% static 'img/12.jpg' %}",
                },
                {
                    id:"13",
                    songName: `Baarishein <br><div class="subtitle">Atif Aslam</div>`,
                    poster: "{% static 'img/13.jpg' %}",
                },
                {
                    id:"14",
                    songName: `Vaaste <br><div class="subtitle">Dhvani Bhanushali</div>`,
                    poster: "{% static 'img/14.jpg' %}",
                },
                {
                    id:"15",
                    songName: `Lut Gaye <br><div class="subtitle">Jubin Nautiyal</div>`,
                    poster: "{% static 'img/15.jpg' %}",
                }
            ]

            Array.from(document.getElementsByClassName('songItem')).forEach((element, i)=>{
                
                console.log(element,"---",i);
                element.getElementsByTagName('img')[0].src = songs[i].poster;
                element.getElementsByTagName('h5')[0].innerHTML = songs[i].songName;}
            )

            let masterPlay = document.getElementById('masterPlay');
            let wave = document.getElementsByClassName('wave')[0];

            masterPlay.addEventListener('click',()=>{
                if (music.paused || music.currentTime <=0) {
                    music.play();
                    masterPlay.classList.remove('bi-play-fill');
                    masterPlay.classList.add('bi-pause-fill');
                    wave.classList.add('active2');
                } else {
                    music.pause();
                    masterPlay.classList.add('bi-play-fill');
                    masterPlay.classList.remove('bi-pause-fill');
                    wave.classList.remove('active2');
                }
            } )


            const makeAllPlays = ()=>{
                Array.from(document.getElementsByClassName('playListPlay')).forEach((element)=>{
                        element.classList.add('bi-play-circle-fill');
                        element.classList.remove('bi-pause-circle-fill');
                })
            }
            const makeAllBackgrounds = () =>{
                Array.from(document.getElementsByClassName('songItem')).forEach((element)=>{
                        element.style.background = "rgb(105, 105, 170, 0)";
                })
                Array.from(document.getElementsByClassName('subtitle')).forEach((element)=>{
                        element.style.color = "#4c5262";
                })
            }
            let index = 0;
            let poster_master_play = document.getElementById('poster_master_play');
            let title = document.getElementById('title');
            Array.from(document.getElementsByClassName('playListPlay')).forEach((element)=>{
                element.addEventListener('click', (e)=>{
                    index = e.target.id;
                    console.log(index);
                    makeAllPlays();
                    e.target.classList.remove('bi-play-circle-fill');
                    e.target.classList.add('bi-pause-circle-fill');
                    if(index==1 || index==2 ||index==3 || index==4 || index==5 || index==6)
                    {
                        if(index==1)
                         {
                            stri="/static/audio/"+"{{ resexp }}1"+".mp3";
                         }
                         else if(index==2)
                         {
                            stri="/static/audio/"+"{{ resexp }}2"+".mp3";
                         }
                         else if(index==3)
                         {
                            stri="/static/audio/"+"{{ resexp }}3"+".mp3";
                         }
                         else if(index==4)
                         {
                            stri="/static/audio/"+"{{ resexp }}4"+".mp3";
                         }
                         else if(index==5)
                         {
                            stri="/static/audio/"+"{{ resexp }}5"+".mp3";
                         }
                         else{
                            stri="/static/audio/"+"{{ resexp }}6"+".mp3";
                         }
                    }else{
                    stri="/static/audio/"+index+".mp3";}
                    music.src = stri;
                    if(index==1 || index==2 ||index==3 || index==4 || index==5 || index==6)
                    {
                        var newim="/static/img/"+"{{ resexp }}"+".jpg";
                    }
                    else{
                    var newim="/static/img/"+index+".jpg";}
                    poster_master_play.src =newim;
                    music.play();
                    let song_title = songs.filter((ele)=>{
                        return ele.id == index;
                    })

                    song_title.forEach(ele =>{
                        let {songName} = ele;
                        title.innerHTML = songName;
                    })
                    masterPlay.classList.remove('bi-play-fill');
                    masterPlay.classList.add('bi-pause-fill');
                    wave.classList.add('active2');
                    music.addEventListener('ended',()=>{
                        masterPlay.classList.add('bi-play-fill');
                        masterPlay.classList.remove('bi-pause-fill');
                        wave.classList.remove('active2');
                    })
                    makeAllBackgrounds();
                    Array.from(document.getElementsByClassName('songItem'))[`${index-1}`].style.background = "#dc143c";
                    Array.from(document.getElementsByClassName('subtitle'))[`${index-1}`].style.color = "white";
                    
                })
            })


            let currentStart = document.getElementById('currentStart');
            let currentEnd = document.getElementById('currentEnd');
            let seek = document.getElementById('seek');
            let bar2 = document.getElementById('bar2');
            let dot = document.getElementsByClassName('dot')[0];

            music.addEventListener('timeupdate',()=>{
                let music_curr = music.currentTime;
                let music_dur = music.duration;

                let min = Math.floor(music_dur/60);
                let sec = Math.floor(music_dur%60);
                if (sec<10) {
                    sec = `0${sec}`
                }
                currentEnd.innerText = `${min}:${sec}`;

                let min1 = Math.floor(music_curr/60);
                let sec1 = Math.floor(music_curr%60);
                if (sec1<10) {
                    sec1 = `0${sec1}`
                }
                currentStart.innerText = `${min1}:${sec1}`;

                let progressbar = parseInt((music.currentTime/music.duration)*100);
                seek.value = progressbar;
                let seekbar = seek.value;
                bar2.style.width = `${seekbar}%`;
                dot.style.left = `${seekbar}%`;
            })

            seek.addEventListener('change', ()=>{
                music.currentTime = seek.value * music.duration/100;
            })

            music.addEventListener('ended', ()=>{
                masterPlay.classList.add('bi-play-fill');
                masterPlay.classList.remove('bi-pause-fill');
                wave.classList.remove('active2');
            })


            let vol_icon = document.getElementById('vol_icon');
            let vol = document.getElementById('vol');
            let vol_dot = document.getElementById('vol_dot');
            let vol_bar = document.getElementsByClassName('vol_bar')[0];

            vol.addEventListener('change', ()=>{
                if (vol.value == 0) {
                    vol_icon.classList.remove('bi-volume-down-fill');
                    vol_icon.classList.add('bi-volume-mute-fill');
                    vol_icon.classList.remove('bi-volume-up-fill');
                }
                if (vol.value > 0) {
                    vol_icon.classList.add('bi-volume-down-fill');
                    vol_icon.classList.remove('bi-volume-mute-fill');
                    vol_icon.classList.remove('bi-volume-up-fill');
                }
                if (vol.value > 50) {
                    vol_icon.classList.remove('bi-volume-down-fill');
                    vol_icon.classList.remove('bi-volume-mute-fill');
                    vol_icon.classList.add('bi-volume-up-fill');
                }

                let vol_a = vol.value;
                vol_bar.style.width = `${vol_a}%`;
                vol_dot.style.left = `${vol_a}%`;
                music.volume = vol_a/100;
            })


            let back = document.getElementById('back');
            let next = document.getElementById('next');

            back.addEventListener('click', ()=>{
                index -= 1;
                if (index < 1) {
                    index = Array.from(document.getElementsByClassName('songItem')).length;
                }
                console.log(index);
                if(index>6){
                    stri="/static/audio/"+index+".mp3";
                    music.src = stri;
                    var newim="/static/img/"+index+".jpg";
                    poster_master_play.src =newim;
                    
                }
                else{
                    stri="/static/audio/"+"{{ resexp }}"+index+".mp3";
                    music.src = stri;
                    var newim="/static/img/"+"{{ resexp }}"+".jpg";
                    poster_master_play.src =newim;
                }
                music.play();
                    let song_title = songs.filter((ele)=>{
                        return ele.id == index;
                })

                song_title.forEach(ele =>{
                    let {songName} = ele;
                    title.innerHTML = songName;
                })
                makeAllPlays();
                masterPlay.classList.add('bi-pause-fill');
                masterPlay.classList.remove('bi-play-fill');
                document.getElementById(`${index}`).classList.remove('bi-play-fill');
                document.getElementById(`${index}`).classList.add('bi-pause-fill');
                makeAllBackgrounds();
                Array.from(document.getElementsByClassName('songItem'))[`${index-1}`].style.background = "#dc143c";
                Array.from(document.getElementsByClassName('subtitle'))[`${index-1}`].style.color = "white";
                
            })
            next.addEventListener('click', ()=>{
                index -= 0;
                index += 1;
                if (index > Array.from(document.getElementsByClassName('songItem')).length) {
                    index = 1;
                    }
                if(index>6){
                    stri="/static/audio/"+index+".mp3";
                    music.src = stri;
                    var newim="/static/img/"+index+".jpg";
                    poster_master_play.src =newim;
                    
                }
                else{
                    stri="/static/audio/"+"{{ resexp }}"+index+".mp3";
                    music.src = stri;
                    var newim="/static/img/"+"{{ resexp }}"+".jpg";
                    poster_master_play.src =newim;
                }
                music.play();
                let song_title = songs.filter((ele)=>{
                    return ele.id == index;
                })

                song_title.forEach(ele =>{
                    let {songName} = ele;
                    title.innerHTML = songName;
                })
                makeAllPlays();

                masterPlay.classList.add('bi-pause-fill');
                masterPlay.classList.remove('bi-play-fill');
                document.getElementById(`${index}`).classList.remove('bi-play-fill');
                document.getElementById(`${index}`).classList.add('bi-pause-fill');
                makeAllBackgrounds();
                Array.from(document.getElementsByClassName('songItem'))[`${index-1}`].style.background = "#dc143c";
                Array.from(document.getElementsByClassName('subtitle'))[`${index-1}`].style.color = "white";
            })


            let left_scroll = document.getElementById('left_scroll');
            let right_scroll = document.getElementById('right_scroll');
            let pop_song = document.getElementsByClassName('pop_song')[0];

            left_scroll.addEventListener('click', ()=>{
                pop_song.scrollLeft -= 330;
            })
            right_scroll.addEventListener('click', ()=>{
                pop_song.scrollLeft += 330;
            })
            //new--------------------
            let checkercheck= "{{ listed }}";
            // alert(checkercheck)
            let i=1;
            function first_song_player(){
                if(checkercheck== 1){
                    // alert(index)
                    document.getElementById(i).click();
                    stri="/static/audio/"+"{{ resexp }}"+i+".mp3";
                    music.src=stri;
                    music.play();
                    let song_title = songs.filter((ele)=>{
                        return ele.id == index;
                    })

                    song_title.forEach(ele =>{
                        let {songName} = ele;
                        title.innerHTML = songName;
                    })
                    makeAllPlays();
                    var num=0
                    var aud = document.getElementById("myAudio");
                    music.onended = function() {
                        masterPlay.classList.remove('bi-pause-fill');
                        masterPlay.classList.add('bi-play-fill');
                        if(i<6){
                            var st1=new String(music.src);
                            var text =st1 ;
                            var n = parseInt(st1[text.search(/\d\.mp3/)]);
                            i=n+1;
                            first_song_player();
                        }
                        else{
                            i=1;
                            first_song_player();
                        }
                        
                    };
                }
                else{
                    document.getElementById('clickHere').click();
                }
                
            }
            
        //console.log(sd);
            //sd.click();
            //////////

            /*left_scrolls.addEventListener('click', ()=>{
                item.scrollLeft -= 330;
            })
            right_scrolls.addEventListener('click', ()=>{
                item.scrollLeft += 330;
            })*/
    </script>
</body>

</html>